# ============================================================================
# NEXO PLATFORM - Development (DEVELOP) Overlay
# ============================================================================
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: nexo-develop

resources:
  - ../../base
  - namespace.yaml

commonLabels:
  app.kubernetes.io/environment: develop

patches:
  # Backend - 2 replicas para DEVELOP
  - target:
      kind: Deployment
      name: nexo-be
    patch: |
      - op: replace
        path: /spec/replicas
        value: 2

  # Frontend - 2 replicas para DEVELOP
  - target:
      kind: Deployment
      name: nexo-fe
    patch: |
      - op: replace
        path: /spec/replicas
        value: 2

  # Ingress - atualizar hosts
  - target:
      kind: Ingress
      name: nexo-ingress
    patch: |
      - op: replace
        path: /spec/rules/0/host
        value: app.hlg.nexo.io
      - op: replace
        path: /spec/rules/1/host
        value: api.hlg.nexo.io
      - op: replace
        path: /spec/rules/2/host
        value: auth.hlg.nexo.io
      - op: replace
        path: /spec/tls/0/hosts
        value:
          - app.hlg.nexo.io
          - api.hlg.nexo.io
          - auth.hlg.nexo.io

configMapGenerator:
  - name: nexo-config
    behavior: merge
    literals:
      - NODE_ENV=homologation
      - LOG_LEVEL=info
      - SWAGGER_ENABLED=true
      - APP_URL=https://api.hlg.nexo.io
      - FRONTEND_URL=https://app.hlg.nexo.io
      - KEYCLOAK_URL=https://auth.hlg.nexo.io
      - KEYCLOAK_REALM=nexo-hlg

  - name: nexo-fe-config
    behavior: merge
    literals:
      - NEXT_PUBLIC_API_URL=https://api.hlg.nexo.io
      - NEXT_PUBLIC_KEYCLOAK_URL=https://auth.hlg.nexo.io
      - NEXT_PUBLIC_KEYCLOAK_REALM=nexo-hlg
